
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LangBattle - ØªØ¹Ù„Ù… ÙˆØªÙ†Ø§ÙØ³</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; }
  header { background:#3b5998; color:white; padding:1rem; text-align:center; font-size:1.5rem; }
  #login-section, #language-section, #game-section, #chat-section {
    max-width: 480px; margin: auto; padding: 1rem; background: white;
    margin-top: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  button { background:#3b5998; color:white; border:none; padding: 0.6rem 1rem; border-radius: 4px; cursor:pointer; }
  button:disabled { background: #888; cursor: not-allowed; }
  input, select { width: 100%; padding: 0.6rem; margin: 0.5rem 0 1rem 0; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
  #questions { margin-bottom: 1rem; }
  .answer-btn { display:block; width: 100%; margin: 0.3rem 0; background: #e4e6eb; color: black; text-align: left; padding: 0.5rem; border-radius: 4px; border: none; cursor: pointer; }
  .answer-btn.correct { background: #4caf50; color: white; }
  .answer-btn.wrong { background: #f44336; color: white; }
  #chat-messages { height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 0.5rem; background: #fafafa; border-radius: 4px; margin-bottom: 0.5rem; }
  .chat-message { margin-bottom: 0.5rem; }
  .chat-message span.username { font-weight: bold; }
  #chat-input { display: flex; }
  #chat-input input { flex: 1; padding: 0.5rem; border-radius: 4px 0 0 4px; border: 1px solid #ccc; }
  #chat-input button { border-radius: 0 4px 4px 0; border:none; background: #3b5998; color: white; cursor: pointer; padding: 0 1rem; }
</style>
</head>
<body>
<header>LangBattle - ØªØ¹Ù„Ù… ÙˆØªÙ†Ø§ÙØ³</header>

<div id="login-section">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
  <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
  <button id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  <button id="signup-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
  <button id="google-login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„</button>
  <div id="login-error" style="color:red;margin-top:0.5rem;"></div>
</div>

<div id="language-section" style="display:none;">
  <h2>Ø§Ø®ØªØ± Ù„ØºØªÙƒ</h2>
  <select id="language-select">
    <option value="en">English - Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="it">Italiano - Ø§Ù„Ø¥ÙŠØ·Ø§Ù„ÙŠØ©</option>
    <option value="fr">FranÃ§ais - Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</option>
    <option value="es">EspaÃ±ol - Ø§Ù„Ø¥Ø³Ø¨Ø§Ù†ÙŠØ©</option>
    <option value="de">Deutsch - Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</option>
    <option value="tr">TÃ¼rkÃ§e - Ø§Ù„ØªØ±ÙƒÙŠØ©</option>
    <option value="ja">æ—¥æœ¬èª - Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©</option>
  </select>
  <button id="start-game-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="game-section" style="display:none;">
  <h2>Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠØ©</h2>
  <div id="user-info"></div>
  <div style="margin-bottom: 0.5rem;">
    <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score-display">0</span></span> |
    <span>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timer">15</span> Ø«Ø§Ù†ÙŠØ©</span>
  </div>
  <div id="questions"></div>
  <button id="next-question-btn" disabled>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
  <button id="end-game-btn" style="margin-top:1rem;">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="chat-section" style="display:none;">
  <h2>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
  <div id="chat-messages"></div>
  <div id="chat-input">
    <input type="text" id="chat-message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
    <button id="chat-send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBxpht9mpvWAcNzsaG1IjPQI7kV1NO4z5c",
    authDomain: "langbattle-48244.firebaseapp.com",
    databaseURL: "https://langbattle-48244-default-rtdb.firebaseio.com",
    projectId: "langbattle-48244",
    storageBucket: "langbattle-48244.appspot.com",
    messagingSenderId: "537558528536",
    appId: "1:537558528536:web:135b7dc1a60eb3e20a496d"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const realtimeDB = firebase.database();

  const bannedWords = ['Ø³ÙŠØ¦Ø©1', 'Ø³ÙŠØ¦Ø©2', 'badword'];

  const questions = {
    ar: [
      { q: "Ù…Ø§ Ù…Ø¹Ù†Ù‰ ÙƒÙ„Ù…Ø© 'apple'ØŸ", a: ["ØªÙØ§Ø­Ø©", "Ù…ÙˆØ²", "ÙƒÙ…Ø«Ø±Ù‰", "Ø¹Ù†Ø¨"], correct: 0 },
      { q: "ØªØ±Ø¬Ù… ÙƒÙ„Ù…Ø© 'car'", a: ["Ø³ÙŠØ§Ø±Ø©", "Ø¯Ø±Ø§Ø¬Ø©", "Ù‚Ø·Ø§Ø±", "Ø·Ø§Ø¦Ø±Ø©"], correct: 0 },
      { q: "Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ØŸ", a: ["Ø£Ø²Ø±Ù‚", "Ø£Ø®Ø¶Ø±", "Ø£Ø­Ù…Ø±", "Ø£ØµÙØ±"], correct: 0 }
    ]
  };

  let selectedLanguage = "ar";
  let currentQuestionIndex = 0;
  let score = 0;
  let timerInterval;
  let timeLeft = 15;

  function getSpeechLang(code) {
    const map = { en: "en-US", ar: "ar-SA", it: "it-IT", fr: "fr-FR", es: "es-ES", de: "de-DE", tr: "tr-TR", ja: "ja-JP" };
    return map[code] || "en-US";
  }

  document.getElementById("login-btn").onclick = () => {
    const email = email.value, password = password.value;
    auth.signInWithEmailAndPassword(email, password).then(showLanguageSection).catch(e => loginError.textContent = "Ø®Ø·Ø£: " + e.message);
  };
  document.getElementById("signup-btn").onclick = () => {
    const email = email.value, password = password.value;
    auth.createUserWithEmailAndPassword(email, password).then(showLanguageSection).catch(e => loginError.textContent = "Ø®Ø·Ø£: " + e.message);
  };
  document.getElementById("google-login-btn").onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(showLanguageSection).catch(e => loginError.textContent = "Ø®Ø·Ø£: " + e.message);
  };

  function showLanguageSection() {
    loginSection.style.display = "none";
    languageSection.style.display = "block";
    chatSection.style.display = "block";
  }

  startGameBtn.onclick = () => {
    selectedLanguage = languageSelect.value;
    languageSection.style.display = "none";
    gameSection.style.display = "block";
    userInfo.textContent = "Ø£Ù†Øª ØªÙ„Ø¹Ø¨ ÙƒÙ€: " + (auth.currentUser?.email || "");
    score = 0;
    currentQuestionIndex = 0;
    scoreDisplay.textContent = "0";
    loadQuestion();
  };

  function loadQuestion() {
    const q = questions[selectedLanguage][currentQuestionIndex];
    questionsDiv.innerHTML = `<p>${q.q} <button id="tts-button">ğŸ”Š</button></p>`;
    q.a.forEach((ans, i) => {
      const btn = document.createElement("button");
      btn.className = "answer-btn";
      btn.textContent = ans;
      btn.onclick = () => {
        clearInterval(timerInterval);
        btn.classList.add(i === q.correct ? "correct" : "wrong");
        if (i === q.correct) scoreDisplay.textContent = ++score;
        document.querySelectorAll(".answer-btn").forEach(b => b.disabled = true);
        nextQuestionBtn.disabled = false;
      };
      questionsDiv.appendChild(btn);
    });
    document.getElementById("tts-button").onclick = () => {
      const utterance = new SpeechSynthesisUtterance(q.q);
      utterance.lang = getSpeechLang(selectedLanguage);
      speechSynthesis.speak(utterance);
    };
    timeLeft = 15;
    timer.textContent = timeLeft;
    timerInterval = setInterval(() => {
      timer.textContent = --timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        document.querySelectorAll(".answer-btn").forEach(b => b.disabled = true);
        nextQuestionBtn.disabled = false;
      }
    }, 1000);
  }

  nextQuestionBtn.onclick = () => {
    currentQuestionIndex++;
    nextQuestionBtn.disabled = true;
    loadQuestion();
  };
  endGameBtn.onclick = () => {
    gameSection.style.display = "none";
    languageSection.style.display = "block";
    clearInterval(timerInterval);
  };

  chatSendBtn.onclick = () => {
    const text = chatMessageInput.value.trim();
    if (!text || bannedWords.some(w => text.includes(w))) return alert("ÙƒÙ„Ù…Ø© Ù…Ù…Ù†ÙˆØ¹Ø©");
    const msgRef = realtimeDB.ref("messages").push();
    msgRef.set({ user: auth.currentUser.email, message: text, timestamp: firebase.database.ServerValue.TIMESTAMP });
    chatMessageInput.value = "";
  };

  realtimeDB.ref("messages").on("child_added", snapshot => {
    const d = snapshot.val();
    const div = document.createElement("div");
    div.className = "chat-message";
    div.innerHTML = `<span class="username">${d.user}:</span> ${d.message}`;
    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  });

  auth.onAuthStateChanged(user => { if (user) showLanguageSection(); });
</script>
</body>
</html>

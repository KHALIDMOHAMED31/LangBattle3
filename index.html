
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LangBattle - ØªØ¹Ù„Ù… ÙˆØªÙ†Ø§ÙØ³</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f2f5; }
  header { background:#3b5998; color:white; padding:1rem; text-align:center; font-size:1.5rem; }
  #login-section, #language-section, #game-section, #chat-section {
    max-width: 480px; margin: auto; padding: 1rem; background: white;
    margin-top: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  button { background:#3b5998; color:white; border:none; padding: 0.6rem 1rem; border-radius: 4px; cursor:pointer; }
  button:disabled { background: #888; cursor: not-allowed; }
  input, select { width: 100%; padding: 0.6rem; margin: 0.5rem 0 1rem 0; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; }
  #questions { margin-bottom: 1rem; }
  .answer-btn { display:block; width: 100%; margin: 0.3rem 0; background: #e4e6eb; color: black; text-align: left; padding: 0.5rem; border-radius: 4px; border: none; cursor: pointer; }
  .answer-btn.correct { background: #4caf50; color: white; }
  .answer-btn.wrong { background: #f44336; color: white; }
  #chat-messages { height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 0.5rem; background: #fafafa; border-radius: 4px; margin-bottom: 0.5rem; }
  .chat-message { margin-bottom: 0.5rem; }
  .chat-message span.username { font-weight: bold; }
  #chat-input { display: flex; }
  #chat-input input { flex: 1; padding: 0.5rem; border-radius: 4px 0 0 4px; border: 1px solid #ccc; }
  #chat-input button { border-radius: 0 4px 4px 0; border:none; background: #3b5998; color: white; cursor: pointer; padding: 0 1rem; }
</style>
</head>
<body>
<header>LangBattle - ØªØ¹Ù„Ù… ÙˆØªÙ†Ø§ÙØ³</header>

<div id="login-section">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
  <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
  <button id="login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  <button id="signup-btn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
  <button id="google-login-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„</button>
  <div id="login-error" style="color:red;margin-top:0.5rem;"></div>
</div>

<div id="language-section" style="display:none;">
  <div id="score-history" style="margin-top: 1rem;">
    <h3>Ù†ØªØ§Ø¦Ø¬Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</h3>
    <ul id="score-list" style="padding: 0 1rem;"></ul>
  </div>
  <h2>Ø§Ø®ØªØ± Ù„ØºØªÙƒ</h2>
  <select id="language-select">
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
  </select>
  <button id="start-game-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="game-section" style="display:none;">
  <h2>Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠØ©</h2>
  <div id="user-info"></div>
  <div style="margin-bottom: 0.5rem;">
    <span>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score-display">0</span></span> |
    <span>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timer">15</span> Ø«Ø§Ù†ÙŠØ©</span>
  </div>
  <div id="questions"></div>
  <button id="next-question-btn" disabled>Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
  <button id="end-game-btn" style="margin-top:1rem;">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
</div>

<div id="chat-section" style="display:none;">
  <h2>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©</h2>
  <div id="chat-messages"></div>
  <div id="chat-input">
    <input type="text" id="chat-message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
    <button id="chat-send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBxpht9mpvWAcNzsaG1IjPQI7kV1NO4z5c",
    authDomain: "langbattle-48244.firebaseapp.com",
    databaseURL: "https://langbattle-48244-default-rtdb.firebaseio.com",
    projectId: "langbattle-48244",
    storageBucket: "langbattle-48244.appspot.com",
    messagingSenderId: "537558528536",
    appId: "1:537558528536:web:135b7dc1a60eb3e20a496d"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const bannedWords = ['Ø³ÙŠØ¦Ø©1', 'Ø³ÙŠØ¦Ø©2', 'badword'];
  const questions = {
    ar: [
      { q: "Ù…Ø§ Ù…Ø¹Ù†Ù‰ ÙƒÙ„Ù…Ø© 'apple'ØŸ", a: ["ØªÙØ§Ø­Ø©", "Ù…ÙˆØ²", "ÙƒÙ…Ø«Ø±Ù‰", "Ø¹Ù†Ø¨"], correct: 0 },
      { q: "ØªØ±Ø¬Ù… ÙƒÙ„Ù…Ø© 'car'", a: ["Ø³ÙŠØ§Ø±Ø©", "Ø¯Ø±Ø§Ø¬Ø©", "Ù‚Ø·Ø§Ø±", "Ø·Ø§Ø¦Ø±Ø©"], correct: 0 },
      { q: "Ù…Ø§ Ù„ÙˆÙ† Ø§Ù„Ø³Ù…Ø§Ø¡ØŸ", a: ["Ø£Ø²Ø±Ù‚", "Ø£Ø®Ø¶Ø±", "Ø£Ø­Ù…Ø±", "Ø£ØµÙØ±"], correct: 0 }
    ]
  };

  let selectedLanguage = "ar";
  let currentQuestionIndex = 0;
  let score = 0;
  let timerInterval;
  let timeLeft = 15;

  function getSpeechLang(code) {
    const map = { ar: "ar-SA" };
    return map[code] || "ar-SA";
  }

  document.getElementById("login-btn").onclick = () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(showLanguageSection)
      .catch(e => document.getElementById("login-error").textContent = "Ø®Ø·Ø£: " + e.message);
  };

  document.getElementById("signup-btn").onclick = () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(showLanguageSection)
      .catch(e => document.getElementById("login-error").textContent = "Ø®Ø·Ø£: " + e.message);
  };

  document.getElementById("google-login-btn").onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithRedirect(provider);
  };

  auth.getRedirectResult().then((result) => {
    if (result.user) showLanguageSection();
  });

  function showLanguageSection() {
  document.getElementById("login-section").style.display = "none";
  document.getElementById("language-section").style.display = "block";
  document.getElementById("chat-section").style.display = "block";

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  const user = auth.currentUser;
  if (user) {
    db.ref("users/" + user.uid + "/scores").once("value", snapshot => {
      const scoreList = document.getElementById("score-list");
      scoreList.innerHTML = "";
      snapshot.forEach(scoreSnap => {
        const s = scoreSnap.val();
        const li = document.createElement("li");
        const date = new Date(s.timestamp).toLocaleString();
        li.textContent = `Ø§Ù„Ù„ØºØ©: ${s.language} - Ø§Ù„Ù†Ù‚Ø§Ø·: ${s.score} - ÙÙŠ: ${date}`;
        scoreList.appendChild(li);
      });
    });
  }
    document.getElementById("login-section").style.display = "none";
    document.getElementById("language-section").style.display = "block";
    document.getElementById("chat-section").style.display = "block";
  }

  document.getElementById("start-game-btn").onclick = () => {
    selectedLanguage = document.getElementById("language-select").value;
    document.getElementById("language-section").style.display = "none";
    document.getElementById("game-section").style.display = "block";
    document.getElementById("user-info").textContent = "Ø£Ù†Øª ØªÙ„Ø¹Ø¨ ÙƒÙ€: " + (auth.currentUser?.email || "");
    score = 0;
    currentQuestionIndex = 0;
    document.getElementById("score-display").textContent = "0";
    loadQuestion();
  };

  function loadQuestion() {
    const q = questions[selectedLanguage][currentQuestionIndex];
    const container = document.getElementById("questions");
    container.innerHTML = `<p>${q.q} <button id="tts-button">ğŸ”Š</button></p>`;
    q.a.forEach((ans, i) => {
      const btn = document.createElement("button");
      btn.className = "answer-btn";
      btn.textContent = ans;
      btn.onclick = () => {
        clearInterval(timerInterval);
        btn.classList.add(i === q.correct ? "correct" : "wrong");
        if (i === q.correct) {
          score++;
          document.getElementById("score-display").textContent = score;
        }
        container.querySelectorAll("button.answer-btn").forEach(b => b.disabled = true);
        document.getElementById("next-question-btn").disabled = false;
      };
      container.appendChild(btn);
    });
    document.getElementById("tts-button").onclick = () => {
      const utterance = new SpeechSynthesisUtterance(q.q);
      utterance.lang = getSpeechLang(selectedLanguage);
      speechSynthesis.speak(utterance);
    };
    timeLeft = 15;
    document.getElementById("timer").textContent = timeLeft;
    timerInterval = setInterval(() => {
      timeLeft--;
      document.getElementById("timer").textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        container.querySelectorAll("button.answer-btn").forEach(b => b.disabled = true);
        document.getElementById("next-question-btn").disabled = false;
      }
    }, 1000);
  }

  document.getElementById("next-question-btn").onclick = () => {
    currentQuestionIndex++;
    document.getElementById("next-question-btn").disabled = true;
    loadQuestion();
  };

  document.getElementById("end-game-btn").onclick = () => {
    clearInterval(timerInterval);
    document.getElementById("game-section").style.display = "none";
    document.getElementById("language-section").style.display = "block";

    // Ø­ÙØ¸ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Firebase
    const user = auth.currentUser;
    if (user) {
      const scoreRef = db.ref("users/" + user.uid + "/scores").push();
      scoreRef.set({
        score: score,
        language: selectedLanguage,
        timestamp: firebase.database.ServerValue.TIMESTAMP
      });
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
    score = 0;
    currentQuestionIndex = 0;
    document.getElementById("score-display").textContent = "0";
  };

  document.getElementById("chat-send-btn").onclick = () => {
    const msg = document.getElementById("chat-message-input").value.trim();
    if (!msg || bannedWords.some(w => msg.includes(w))) return alert("Ø±Ø³Ø§Ù„Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©");
    db.ref("messages").push({
      user: auth.currentUser.email,
      message: msg,
      timestamp: firebase.database.ServerValue.TIMESTAMP
    });
    document.getElementById("chat-message-input").value = "";
  };

  db.ref("messages").on("child_added", (snap) => {
    const d = snap.val();
    const div = document.createElement("div");
    div.className = "chat-message";
    div.innerHTML = `<span class="username">${d.user}:</span> ${d.message}`;
    document.getElementById("chat-messages").appendChild(div);
    document.getElementById("chat-messages").scrollTop = document.getElementById("chat-messages").scrollHeight;
  });

  auth.onAuthStateChanged(user => {
    if (user) showLanguageSection();
  });
</script>
</body>
</html>
